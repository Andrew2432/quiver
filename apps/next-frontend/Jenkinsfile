pipeline {
  agent any

  stages {
    stage('SCM Checkout') {
      steps {
        git branch: 'feature/jenkins', credentialsId: 'github-ssh', url: 'git@github.com:ajoel24/quiver.git'
      }
    }

    stage('Install dependencies') {
      steps {
        nodejs('my-nodejs') {
          sh "cd apps/next-frontend && npm install"
        }
      }
    }

    stage('SonarQube scan') {
      steps {
        script {
          def scannerHome = tool name: 'my-sonarqube', type: 'hudson.plugins.sonar.SonarRunnerInstallation';

          withSonarQubeEnv(credentialsId: 'sonarqube-token', installationName: 'my-sonarqube') {
            sh "cd apps/next-frontend/ && ${scannerHome}/bin/sonar-scanner"
          }
        }
      }
    }
  }
}