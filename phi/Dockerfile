FROM node:14.15.4-alpine

ARG NEXT_PUBLIC_WP_API_URL
ARG NEXT_PUBLIC_WP_CONTACT_URL
ARG NEXT_PUBLIC_WP_PROJECT_URL
ARG NEXT_PUBLIC_GRC_SITE_KEY
ARG NEXT_PUBLIC_GRC_SECRET_KEY
ARG NEXT_PUBLIC_BASE_URL
ARG NEXT_PUBLIC_GA_ID 
ARG NEXT_PUBLIC_AUTHOR_EMAIL

# Create app directory
RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

# Installing dependencies
COPY package.json ./
COPY package-lock.json ./

RUN npm install

# Copying source files
COPY . .
#COPY .env.production .env

ENV NODE_ENV production
ENV NEXT_PUBLIC_WP_API_URL=$NEXT_PUBLIC_WP_API_URL
ENV NEXT_PUBLIC_WP_CONTACT_URL=$NEXT_PUBLIC_WP_CONTACT_URL
ENV NEXT_PUBLIC_WP_PROJECT_URL=$NEXT_PUBLIC_WP_PROJECT_URL
ENV NEXT_PUBLIC_GRC_SITE_KEY=$NEXT_PUBLIC_GRC_SITE_KEY
ENV NEXT_PUBLIC_GRC_SECRET_KEY=$NEXT_PUBLIC_GRC_SECRET_KEY
ENV NEXT_PUBLIC_BASE_URL=$NEXT_PUBLIC_BASE_URL
ENV NEXT_PUBLIC_GA_ID=$NEXT_PUBLIC_GA_ID
ENV NEXT_PUBLIC_AUTHOR_EMAIL=$NEXT_PUBLIC_AUTHOR_EMAIL

# Building app
RUN npm run build
EXPOSE 3000

USER node

# Running the app
CMD [ "npm", "start" ]
